<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>Pinyin Input Method</title>
        <link rel="stylesheet" href="css/style.css">
        <link rel="manifest" href="manifest.json">
    </head>
    <body>
        <div class="main-layout">
            <div class="toolbar">
                <button id="l-hist-btn" class="btn btn-toggle" onclick="toggleHistoryPanel()">剪切板</button>
                <div class="toolbar-divider"></div>
                
                <div id="practice-toolbar-left" class="practice-toolbar">
                </div>

                <button id="practice-mode-btn" class="btn btn-toggle" onclick="startPracticeMode()">练习模式</button>
                <button id="exit-practice-mode-btn" class="btn btn-danger" onclick="exitPracticeMode()" style="display: none;">退出练习</button>
                
                <div style="margin-left: auto; display: flex; gap: 10px;">
                    <button id="theme-toggle-btn" class="btn btn-toggle" onclick="toggleTheme()">深色模式</button>
                    <a href="https://github.com/123qweraz/webime" target="_blank" class="btn btn-github">GitHub Star</a>
                    <button class="btn btn-toggle" onclick="openSettingsSidebar()">词典设置</button>
                </div>
            </div>

            <div class="content-area">
                <div class="history-panel" id="historyPanel">
                    <div class="history-header">
                        <span>剪切板历史</span>
                        <button onclick="clearHistory()" class="btn btn-toggle btn-sm" style="font-size: 11px;">清空</button>
                    </div>
                    <ul id="historyList" class="history-list"></ul>
                </div>
                
                <div class="center-container">
                    <div class="output-card" id="output-card">
                        <div id="output-area" spellcheck="false" contenteditable="true"></div>
                        <div class="control-group">
                            <button id="search-btn" class="btn btn-toggle" style="background: #4285f4; color: white;" onclick="searchGoogle()">搜索 (Ctrl+G)</button>
                            <button class="btn btn-toggle active" style="background: #222; color: white;" onclick="archiveAndCopy()">归档并复制</button>
                        </div>
                    </div>

                    <div id="practice-container">
                        <div id="practice-directory" class="practice-directory-view" style="display: none;">
                            <!-- Chapters will be rendered here -->
                        </div>

                        <div id="card-left" class="practice-card-slot">
                            <div class="practice-card-content">
                                <div class="card-rotate-btn" title="旋转 (Rotate)">↻</div>
                                <div class="card-face card-front">
                                    <div class="pinyin-display"></div>
                                    <div class="hanzi-display"></div>
                                    <div class="en-display" style="display: none;"></div>
                                </div>
                                <div class="card-face card-back">
                                    <div class="pinyin-display" style="visibility: hidden;"></div>
                                    <div class="hanzi-display"></div>
                                    <div class="en-display"></div>
                                </div>
                            </div>
                        </div>
                        <div id="card-center" class="practice-card-slot">
                            <div class="practice-card-content">
                                <div class="card-rotate-btn" title="旋转 (Rotate)">↻</div>
                                <div class="card-face card-front">
                                    <div class="pinyin-display"></div>
                                    <div class="hanzi-display"></div>
                                    <div class="en-display" style="display: none;"></div>
                                </div>
                                <div class="card-face card-back">
                                    <div class="pinyin-display" style="visibility: hidden;"></div>
                                    <div class="hanzi-display"></div>
                                    <div class="en-display"></div>
                                </div>
                            </div>
                        </div>
                        <div id="card-right" class="practice-card-slot">
                            <div class="practice-card-content">
                                <div class="card-rotate-btn" title="旋转 (Rotate)">↻</div>
                                <div class="card-face card-front">
                                    <div class="pinyin-display"></div>
                                    <div class="hanzi-display"></div>
                                    <div class="en-display" style="display: none;"></div>
                                </div>
                                <div class="card-face card-back">
                                    <div class="pinyin-display" style="visibility: hidden;"></div>
                                    <div class="hanzi-display"></div>
                                    <div class="en-display"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="practice-footer" style="display: none; justify-content: center; align-items: center; gap: 20px; margin-top: 20px;">
                        <button id="back-to-dir-btn" class="btn btn-toggle" onclick="showPracticeDirectory()">章节目录</button>
                        <button id="toggle-browse-btn" class="btn btn-toggle" onclick="toggleBrowseMode()">浏览模式</button>
                        <button id="toggle-pinyin-btn" class="btn btn-toggle" onclick="togglePinyinHint()">显示拼音 (F2)</button>
                        <button id="toggle-hanzi-btn" class="btn btn-toggle" onclick="toggleHanziPrompt()">隐藏汉字 (F4)</button>
                        <button id="toggle-english-btn" class="btn btn-toggle" onclick="toggleEnglishHint()">显示释义 (F8)</button>
                        <button id="play-sound-btn" class="btn btn-toggle" onclick="handleManualRead(event)">朗读 (F3)</button>
                        <button id="toggle-tts-btn" class="btn btn-toggle" onclick="toggleAutoTTS()">自动朗读</button>
                    </div>

                    <div class="resizer-v" id="center-v-resizer"></div>

                    <div class="input-card focused" id="input-container">
                        <div class="input-status-bar">
                            <div id="buffer-display"></div>
                            <div id="page-counter"></div>
                        </div>
                        <div id="main-candidates"></div>
                        <input type="text" id="hidden-input" autocomplete="off" />
                    </div>
                </div>
            </div>
        </div>

        <div id="loading-overlay">
            <div id="loading-spinner"></div>
            <p>正在初始化...</p>
        </div>
        <div id="inputMethodToast" class="input-method-toast"></div>

        <div id="settings-sidebar-backdrop" class="sidebar-backdrop" onclick="closeSettingsSidebar()"></div>
        <div id="settings-sidebar" class="settings-sidebar">
            <div class="sidebar-header">
                <h3>词典方案设置</h3>
                <button class="sidebar-close-btn" onclick="closeSettingsSidebar()">&times;</button>
            </div>
            
            <div class="sidebar-tabs">
                <div id="tab-btn-chinese" class="sidebar-tab active" data-tab="chinese" onclick="switchDictTab('chinese')">中文</div>
                <div id="tab-btn-japanese" class="sidebar-tab" data-tab="japanese" onclick="switchDictTab('japanese')">日语</div>
                <div id="tab-btn-user" class="sidebar-tab" data-tab="user" onclick="switchDictTab('user')">用户</div>
                <div id="tab-btn-settings" class="sidebar-tab" data-tab="settings" onclick="switchDictTab('settings')">设置</div>
                <div id="tab-btn-practice" class="sidebar-tab" data-tab="practice" onclick="switchDictTab('practice')" style="display: none;">练习</div>
            </div>
            
            <div class="sidebar-content">
                <div id="tab-chinese" class="tab-content active"></div>
                <div id="tab-japanese" class="tab-content"></div>
                <div id="tab-user" class="tab-content"></div>
                <div id="tab-settings" class="tab-content"></div>
                <div id="tab-practice" class="tab-content"></div>
            </div>
        </div>

        <div id="startup-guide" class="startup-guide-overlay" style="display: none;">
            <div class="startup-guide-content">
                <div class="startup-guide-header">
                    <h2>欢迎使用 WebIME</h2>
                    <p>一款轻量级、智能的在线拼音输入法</p>
                </div>
                <div class="startup-guide-body">
                    <div class="guide-item">
                        <div class="guide-key">Shift</div>
                        <div class="guide-desc">
                            <h4>切换中文过滤</h4>
                            <p>在输入过程中按 <strong>Shift</strong> 键，可以快速在拼音检索和中文过滤模式间切换。</p>
                        </div>
                    </div>
                    <div class="guide-item">
                        <div class="guide-key">Tab</div>
                        <div class="guide-desc">
                            <h4>转成英文模式</h4>
                            <p>按 <strong>Tab</strong> 键可以直接将当前的输入转换为英文模式，或在不同输入状态间循环。</p>
                        </div>
                    </div>
                    <div class="guide-tips">
                        <p>💡 提示：按 <strong>Enter</strong> 直接上屏字母，按 <strong>空格</strong> 选择首位候选词。</p>
                    </div>
                </div>
                <div class="startup-guide-footer">
                    <button class="btn btn-action btn-large" onclick="closeStartupGuide()">开始体验</button>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script type="module" src="js/wasm-bridge.js"></script>
        <script src="js/config.js"></script>
        <script src="js/utils.js"></script>
        <script src="js/trie.js"></script>
        <script src="js/history.js"></script>
        <script src="js/practice.js"></script>
        <script src="js/dict-manager.js"></script>
        <script src="js/ime.js"></script>
        <script src="js/main.js"></script>
        <script>
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./sw.js')
                        .then(registration => {
                            console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        })
                        .catch(err => {
                            console.log('ServiceWorker registration failed: ', err);
                        });
                });
            }
        </script>
    </body>
</html>
