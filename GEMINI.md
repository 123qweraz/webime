# Gemini 协作编程规范 (WebIME Project)

本文档定义了 AI 在参与 WebIME 开发时的核心准则与操作流程，确保代码质量、逻辑一致性及 Git 提交的规范性。

## 1. 开发哲学 (Unix Style)

- **单一职责**：每个函数或模块只做一件事（如 `trie.js` 只负责检索，`ime.js` 只负责状态分发）。
- **组合胜过膨胀**：通过清晰的接口（如 `update()` 调度流）组合功能，而不是在单个函数中堆砌逻辑。
- **数据驱动**：优先考虑数据结构（如候选词对象数组）的清晰度，UI 仅作为数据的镜像。
- **原型先行**：优先实现核心闭环，再通过迭代完善边缘情况。

## 2. 状态机规范 (State Machine)

WebIME 严格遵循 `InputState` 状态管理：
- `NORMAL`: 标准 IME 输入状态。
- `PRACTICE`: 练习模式，锁定输入并进行字符校验。
- `EDIT`: 自由编辑状态，解除输出区域锁定。
- `CORRECTION`: 长句模式，提供分段候选词修正。
- `TAB`: 辅助过滤模式，基于英文描述进行检索。

**修改准则**：新增功能必须明确其所属状态，不得污染全局键盘事件处理逻辑。

## 3. Workflow & Git 规范

### 3.1 修改前置条件与验证
- **Git 状态检查**：在修改任何代码前，必须执行 `git status` 确保当前工作区是干净的。
- **需求确认**：若用户指令涉及模糊状态变更，必须先通过对话确认需求。
- **强制自测**：在向用户提交工作前，**必须**先自行执行测试逻辑（如运行测试脚本或模拟关键路径），确保功能符合预期且无回退。
- **DOM 完整性检查**：若修改了 HTML 中的 ID 或结构，**必须**全量搜索 JS 代码，确保所有对应的 `getElementById` 或选择器已同步更新，严禁出现 Null 指针异常。
- **Console-First 哲学**：在交付前，必须在脑中模拟浏览器控制台输出，预判可能出现的 ReferenceError 或 TypeError。

### 3.2 提交规范
- **小步快跑**：每次完成一个独立的逻辑修复、UI 调整或功能闭环后，**必须**立即 commit，禁止堆积大量变更。
- **提交信息格式**：
  - `feat`: 新功能 (如练习系统)
  - `fix`: 修复 Bug (如 CSS 样式恢复)
  - `refactor`: 重构 (如拆分 update 函数)
  - `perf`: 性能优化
- **严禁强制推送**：永远不要执行 `git push`，除非用户明确要求。

### 3.3 留痕要求 (history_dialog.md)
- 所有关键的设计决策、重大 Bug 修复及交互逻辑变更，**必须** 记录在 `history_dialog.md` 顶部。

## 4. UI 与样式规范

- **变量优先**：使用 `style.css` 中的 CSS 变量（`--primary`, `--bg` 等）处理主题颜色。
- **无障碍性**：保持文字对比度，候选词必须有清晰的索引提示。
- **响应式**：确保在缩放和窗口调整大小时布局不发生坍塌。

## 5. 最终准则

**代码的可维护性 > 巧妙的 Trick**。在 AI 生成代码时，优先选择易于 Diff 和理解的实现方案。